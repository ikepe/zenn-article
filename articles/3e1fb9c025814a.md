---
title: "ChatGPTをDiscordに導入する方法をChatGPTに聞いてみた"
emoji: "📚"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Chat-GPT", "discord", "python"]
published: false
---

## 経緯について
  最近ニュースでもよく聞くようになったOpenAI社の"ChatGPT"ですが、ふとDiscordで使えたら便利だなと思い、この記事を書き始めました。プログラムも作れると聞いていたので、あえて完全に丸投げするとどうなるのだろうという好奇心が後押ししました。また、Discordのbotを作るたびに作りかたを調べているので、自分で言語化して覚えてしまいたいというのも経緯の一つです。

## そもそもChatGPTとは
　せっかくなのでChatGPTに「ChatGPTの特徴を教えて」と聞いてみました。
  > ChatGPTは、OpenAIによってトレーニングされた大型の自然言語生成モデルです。特徴として以下が挙げられます。
  > 1. 膨大なデータセットに基づいてトレーニングされているため、人間のように自然なテキストを生成できます。
  > 2. 複数のタスクに対応する能力があり、Q&A、文書生成、文章要約などの様々なタスクで使用することができます。
  > 3. 高い精度とリアルタイム性能を有しています。
  > 4. APIを通じて利用することができるため、開発者は自分のアプリケーションやサービスで使用することができます。
  
  今回はこの4番目が需要になります。ChatGPTはAPIが公開されており、独自のアプリケーションやサービスで使用することができるのです。以降、Discordのbotを作成する手順を、ChatGPTの答えを基に書いていきます。

## 導入手順
  導入手順を聞いてみると以下の通り返答がありました。
  > ChatGPTをDiscordに導入するには以下の手順があります。
  > 1. Discord Botアカウントを作成する
  > 2. OpenAI API Keyを取得する
  > 3. DiscordのBotを開発するためのライブラリをインストールする
  > 4. Botのコードを作成し、OpenAI API Keyを使用してChatGPTモデルにアクセスする
  > 5. BotをDiscordサーバーに導入して動作を確認する
  >
  > 詳細については、関連のオンライン資源やチュートリアルを参照することをお勧めします。

  ChatGPTの指示通りに進めていきます。

### 1. Discord Botアカウントを作成する
  そのままですが、Discordのbotアカウントを作成します。Doscordの開発者ページの[Application](https://discord.com/developers/applications)にアクセスし、*New Application*を選択し名前を入力します。
  ![New Applicationボタン](/images/discord-1.jpg)
  次に左からbotという項目を選択し、"Privileged Gateway Intents"のチェックマークをすべてチェックにします。
  ![チェックマークについて](/images/discord-2.jpg)

### 2. OpenAI API Keyを取得する
  ここではOpenAIのAPIを取得します。OpenAInのアカウントを持っていない場合は、作成しましょう。
  以下のサイトでAPIの取得をします。
  https://platform.openai.com/account/api-keys

  ![APIの取得](/images/discord-3.jpg)

### 3. DiscordのBotを開発するためのライブラリをインストールする
  今回必要となるライブラリは　discord.py、OpenAI APIクライアントライブラリをpipを用いて入れます。
  ```
  pip install discord.py
  ```
  ```
  pip install openai
  ```

### 4. Botのコードを作成し、OpenAI API Keyを使用してChatGPTモデルにアクセスする
  Pythonのプログラムを作成します。こちらもOpenAIに作成してもらいました。
  ``` python
  import discord
  import openai

  # Discord Botのトークンを設定
  TOKEN = 'YOUR_BOT_TOKEN'

  # OpenAI APIキーを設定
  openai.api_key = "YOUR_OPENAI_API_KEY"

  # Discord Botのクライアントを作成
  client = discord.Client()

  # Botが起動したときの処理
  @client.event
  async def on_ready():
    print(f'{client.user} has connected to Discord!')

  # メッセージが送信されたときの処理
  @client.event
  async def on_message(message):
    if message.author == client.user:
      return

    # OpenAI APIを使用して、メッセージに対する応答を生成する
    response = openai.Completion.create(
      engine="text-davinci-002",
      prompt=f"{message.content}",
      max_tokens=1024,
      n=1,
      stop=None,
      temperature=0.5,
    ).get("choices")[0].text

    # 応答を送信する
    await message.channel.send(response)

  # Discord Botを起動する
  client.run(TOKEN)
  ```

  しかし、トークンやAPIキーを入れても以下のようなエラーが出て動作しませんでした。
  ```
  TypeError: __init__() missing 1 required keyword-only argument: ‘intents’
  ```

  これはintentsが設定されていないというエラーで、2020年の10月から設定が必須になったようです。
  そのため以下のように修正しました。
  ```diff python
  # Discord Botのクライアントを作成
  - client = discord.Client()
  + client = discord.Client(intents=discord.Intents.all())
  ```
  以下のサイトを参考にさせていただきました。
  ![猿でもわかる！discord.pyのIntentsについて！](https://zenn.dev/disneyresidents/articles/discordintents)

### 5. BotをDiscordサーバーに導入して動作を確認する
  最後にDiscordサーバにbotを追加します。
  1.Discord Botアカウントを作成する　でアクセスしたページの左側にあるOAuth2 > URL Generatorを選択します。SCOPE(スコープ)はbotを、Bot Permissions(botの権限)は `Read Messages/View Channels` と `Send Messages` にチェックを入れ、下に表示されるURLにアクセスします。
  ![招待URLの生成](/images/discord-3.jpg)

  あとはサーバ側でPythonファイルを実行するだけで動作させることができます。